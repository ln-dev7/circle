name: Sync master to develop

on:
  push:
    branches:
      - master
  workflow_dispatch:
    inputs:
      from_branch:
        description: 'Source branch to sync from'
        required: true
        default: 'master'
        type: string
      to_branch:
        description: 'Target branch to sync to'
        required: true
        default: 'develop'
        type: string
permissions:
  contents: write
  pull-requests: write

jobs:
  sync-master-to-develop:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: 📝 Create Pull Request
        id: sync
        uses: tretuna/sync-branches@1.4.0
        with:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          FROM_BRANCH: ${{ github.event.inputs.from_branch || 'master' }}
          TO_BRANCH: ${{ github.event.inputs.to_branch || 'develop' }}
          PULL_REQUEST_TITLE: "chore(release): Sync ${{ github.event.inputs.from_branch || 'master' }} to ${{ github.event.inputs.to_branch || 'develop' }}"
          PULL_REQUEST_BODY: |
            ## 🔄 Sync ${{ github.event.inputs.from_branch || 'master' }} to ${{ github.event.inputs.to_branch || 'develop' }}

            This PR syncs the latest changes from `${{ github.event.inputs.from_branch || 'master' }}` branch into `${{ github.event.inputs.to_branch || 'develop' }}`.

            ### 📋 What's included
            - 🔥 Contains latest changes from ${{ github.event.inputs.from_branch || 'master' }} (hotfixes, patches, etc.)
            - 🤖 Auto-generated by [sync-branches][1]
            - 📦 Ready for deployment to develop environment after merge

            ### ⚠️ Merge Instructions
            **Please merge this PR using "Create a merge commit" option to maintain branch history.**
            - ✅ Use: **Create a merge commit** (equivalent to `git merge --no-ff`)
            - ❌ Avoid: Squash and merge or Rebase and merge

            ### 🚨 If conflicts appear
            If this PR shows merge conflicts:
            1. Resolve conflicts directly in GitHub or locally
            2. Ensure all tests pass after resolution
            3. Merge using "Create a merge commit" option

            [1]: https://github.com/tretuna/sync-branches
          CONTENT_COMPARISON: true

      - name: 📊 Summary
        run: |
          echo "✅ Sync workflow completed"
          echo "📋 PR Title: chore(release): Sync ${{ github.event.inputs.from_branch || 'master' }} to ${{ github.event.inputs.to_branch || 'develop' }}"
          echo "🔗 PR URL: ${{ steps.sync.outputs.PULL_REQUEST_URL }}"
          echo "📝 PR Number: ${{ steps.sync.outputs.PULL_REQUEST_NUMBER }}"
          echo "📝 Please review and merge the PR to sync ${{ github.event.inputs.from_branch || 'master' }} with ${{ github.event.inputs.to_branch || 'develop' }}"
